  const DIS = {
    ganhos:[
      'Sustentação dos resultados 5S e redução de reincidências.',
      'Melhoria contínua e cultura de responsabilidade.',
      'Equipe mais engajada e comprometida.'
    ],
    riscos:[
      'Falta de acompanhamento faz o 5S “voltar atrás”.',
      'Equipe perde credibilidade quando o padrão não é seguido.',
      'Resultados se tornam inconsistentes.'
    ],
    acoes:[
      'Crie rotina de auditoria 5S (quinzenal ou mensal).',
      'Valorize boas práticas publicamente.',
      'Corrija desvios com diálogo e reforço positivo.'
    ]
  };
  switch(key){
    case 'utilizacao': return UTIL;
    case 'organizacao': return ORG;
    case 'limpeza': return LIM;
    case 'padronizacao': return PAD;
    case 'disciplina': return DIS;
    default: return { ganhos:[], riscos:[], acoes:[] };
  }
}

// CSV
function exportCSV(data){
  const rows = [];
  rows.push(['Senso','Pergunta','Resposta','Nota']);
  const order = ['utilizacao','organizacao','limpeza','padronizacao','disciplina'];
  order.forEach(key => {
    const senso = data.senses[key]; if(!senso) return;
    senso.questions.forEach(q => rows.push([senso.title, q.text, q.answerRaw ?? '', q.score ?? '']));
  });
  const csv = '\ufeff' + rows.map(r => r.map(v => '"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  const name = getProfileName();
  a.download = `respostas_5S10X_${name || 'usuario'}.csv`;
  a.click(); URL.revokeObjectURL(a.href);
}

// PDF (captura do bloco principal)
async function generatePDF(){
  const el = document.getElementById('resultado');
  if(!el){ alert('Seção de resultados não encontrada.'); return; }
  const { jsPDF } = window.jspdf || {};
  if(!jsPDF){ alert('Biblioteca jsPDF não encontrada.'); return; }

  const perfil = getProfileInfo();
  const dateStr = new Date().toLocaleDateString('pt-BR');

  // Header em canvas para compor com o conteúdo
  const header = document.createElement('div');
  header.style.padding = '12px 16px';
  header.style.background = '#0b1220';
  header.style.color = '#e5e7eb';
  header.style.border = '1px solid #223047';
  header.style.borderRadius = '12px';
  header.innerHTML = `<strong>Diagnóstico 5S 10X – Avaliação VPS</strong><br/>Nome: ${perfil.name || '-'} • E-mail: ${perfil.email || '-'} • Empresa/Posto: ${perfil.company || '-'} • Data: ${dateStr}`;
  el.prepend(header);

  const canvas = await html2canvas(el, { scale: 2, backgroundColor: '#0b1220' });
  header.remove(); // remove header visual após captura

  const imgData = canvas.toDataURL('image/png');
  const pdf = new jsPDF('p','mm','a4');